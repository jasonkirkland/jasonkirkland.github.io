<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Clock</title>
    <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEAAQMAAABmvDolAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAB5JREFUaN7twQENAAAAwqD3T20PBxQAAAAAAAAAAHwYCcAAAVjE9woAAAAASUVORK5CYII=">
    <link rel="manifest" href='data:application/manifest+json,{"name":"Clock","short_name":"Clock","display":"standalone","background_color":"#000000","theme_color":"#000000"}'>
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }


    :root {
        --safe-top: env(safe-area-inset-top, 0px);
        --safe-right: env(safe-area-inset-right, 0px);
        --safe-bottom: env(safe-area-inset-bottom, 0px);
        --safe-left: env(safe-area-inset-left, 0px);
    }

    html, body {
        height: 100%;
        height: 100dvh;
        background: #000;
        overflow: hidden;
    }

    body {
        color: gainsboro;
        font-family: -apple-system, "Helvetica Neue", Arial, sans-serif;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: var(--safe-top) var(--safe-right) var(--safe-bottom) var(--safe-left);
    }

    /* ── Container keeps everything in view ── */
    #container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        width: 100%;
        max-height: 100%;
        gap: 0.5vh;
        padding: 1vh 2vw;
    }

    /* ── CLOCK — the star of the show ── */
    #clock {
        font-weight: 700;
        line-height: 1;
        letter-spacing: -0.02em;
        font-variant-numeric: tabular-nums;
    }

    /* ── Date ── */
    #date {
        opacity: 0.6;
        line-height: 1.2;
    }

    /* ── Current temp ── */
    #current-temp {
        font-weight: 600;
        line-height: 1.1;
    }

    /* ── Conditions ── */
    #conditions {
        opacity: 0.5;
        line-height: 1.2;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 90vw;
    }

    /* ── Forecast row ── */
    #forecast {
        display: flex;
        justify-content: center;
        gap: 3vw;
        opacity: 0.55;
    }

    .forecast-day { text-align: center; }
    .forecast-day-name { margin-bottom: 0.3vh; }

    .high { color: #ff6b6b; }
    .low  { color: #4dabf7; }

    /* ── Refresh button ── */
    #reload-btn {
        position: fixed;
        top: calc(12px + var(--safe-top));
        right: calc(12px + var(--safe-right));
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: rgba(220, 220, 220, 0.5);
        font-size: 22px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
        -webkit-tap-highlight-color: transparent;
        z-index: 10;
    }
    #reload-btn:active { background: rgba(255, 255, 255, 0.25); }

    /* ═══════════════════════════════════════
       PORTRAIT — tall screens
       ═══════════════════════════════════════ */
    @media (orientation: portrait) {
        #clock        { font-size: 26vw; }
        #date         { font-size: 3.8vw; }
        #current-temp { font-size: 14vw; }
        #conditions   { font-size: 3.8vw; }
        .forecast-day-name { font-size: 3.2vw; }
        .forecast-temps    { font-size: 3.5vw; }
        #container { gap: 1vh; }
    }

    /* Smaller phones portrait (iPhone SE, etc) */
    @media (orientation: portrait) and (max-width: 400px) {
        #clock        { font-size: 28vw; }
        #current-temp { font-size: 15vw; }
    }

    /* ═══════════════════════════════════════
       LANDSCAPE — this is the primary mode
       ═══════════════════════════════════════ */
    @media (orientation: landscape) {
        #container {
            gap: 0.3vh;
            padding: 0.5vh 2vw;
        }

        /* Clock dominates */
        #clock        { font-size: min(30vw, 42vh); }
        #date         { font-size: min(2.8vw, 4.5vh); }
        #current-temp { font-size: min(10vw, 16vh); }
        #conditions   { font-size: min(2.2vw, 3.8vh); }
        .forecast-day-name { font-size: min(1.8vw, 3vh); }
        .forecast-temps    { font-size: min(2vw, 3.2vh); }
        #forecast { gap: 2.5vw; }
    }

    /* ── Short landscape (iPhones, smaller iPads) ── */
    @media (orientation: landscape) and (max-height: 450px) {
        #clock        { font-size: min(26vw, 38vh); }
        #current-temp { font-size: min(8vw, 14vh); }
        #conditions   { font-size: min(2vw, 3.5vh); }
        .forecast-day-name { font-size: min(1.6vw, 2.8vh); }
        .forecast-temps    { font-size: min(1.8vw, 3vh); }
    }

    /* ── Tall landscape (full-size iPads) ── */
    @media (orientation: landscape) and (min-height: 700px) {
        #container { gap: 1vh; }
        #clock        { font-size: min(28vw, 36vh); }
        #current-temp { font-size: min(10vw, 14vh); }
        #conditions   { font-size: min(2.5vw, 4vh); }
        .forecast-day-name { font-size: min(2vw, 3vh); }
        .forecast-temps    { font-size: min(2.2vw, 3.5vh); }
    }
</style>


</head>
<body>
    <div id="container">
        <div id="clock"></div>
        <div id="date"></div>
        <div id="current-temp">--°</div>
        <div id="conditions">Loading weather…</div>
        <div id="forecast"></div>
    </div>
    <button id="reload-btn" onclick="location.reload()">↻</button>


<script>
    /* ── Clock ── */
    function updateClock() {
        const now = new Date();
        let h = now.getHours() % 12 || 12;
        const m = String(now.getMinutes()).padStart(2, '0');
        document.getElementById('clock').textContent = `${h}:${m}`;
        document.getElementById('date').textContent = now.toLocaleDateString('en-US', {
            weekday: 'long', month: 'long', day: 'numeric'
        });
    }
    updateClock();
    setInterval(updateClock, 1000);

    /* ── Weather ── */
    const LAT = 33.21;
    const LON = -97.13;
    const OM_URL = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current=temperature_2m,weather_code,wind_speed_10m&daily=temperature_2m_max,temperature_2m_min,weather_code&temperature_unit=fahrenheit&wind_speed_unit=mph&timezone=America%2FChicago&forecast_days=4`;

    function wmoDescription(code) {
        const map = {
            0:'Clear',1:'Mostly Clear',2:'Partly Cloudy',3:'Overcast',
            45:'Foggy',48:'Rime Fog',
            51:'Lt Drizzle',53:'Drizzle',55:'Hvy Drizzle',
            61:'Lt Rain',63:'Rain',65:'Heavy Rain',
            71:'Lt Snow',73:'Snow',75:'Heavy Snow',77:'Snow Grains',
            80:'Showers',81:'Mod Showers',82:'Heavy Showers',
            85:'Snow Showers',86:'Hvy Snow Showers',
            95:'T-Storm',96:'T-Storm/Hail',99:'Severe T-Storm'
        };
        return map[code] || 'N/A';
    }

    function dayName(dateStr) {
        const d = new Date(dateStr + 'T12:00:00');
        const today = new Date();
        today.setHours(12,0,0,0);
        const diff = Math.round((d - today) / 86400000);
        if (diff === 0) return 'Today';
        if (diff === 1) return 'Tomorrow';
        return d.toLocaleDateString('en-US', { weekday: 'short' });
    }

    async function getWeather() {
        const MAX_ATTEMPTS = 4;
        const RETRY_MS = 10000;

        for (let i = 1; i <= MAX_ATTEMPTS; i++) {
            try {
                const res = await fetch(OM_URL);
                const data = await res.json();
                if (!data.current || data.current.temperature_2m == null) throw new Error('No temp');

                const temp = Math.round(data.current.temperature_2m);
                const cond = wmoDescription(data.current.weather_code);
                const wind = Math.round(data.current.wind_speed_10m || 0);

                document.getElementById('current-temp').textContent = `${temp}°`;
                document.getElementById('conditions').textContent = `${cond}  ·  ${wind} mph`;

                // Build 3-day forecast (skip today → indices 1,2,3)
                const daily = data.daily;
                let html = '';
                for (let d = 1; d <= 3 && d < daily.time.length; d++) {
                    html += `<div class="forecast-day">
                        <div class="forecast-day-name">${dayName(daily.time[d])}</div>
                        <div class="forecast-temps">
                            <span class="high">${Math.round(daily.temperature_2m_max[d])}°</span>
                            <span class="low">${Math.round(daily.temperature_2m_min[d])}°</span>
                        </div>
                    </div>`;
                }
                document.getElementById('forecast').innerHTML = html;
                console.log(`Weather updated (attempt ${i})`);
                return;
            } catch (e) {
                console.warn(`Weather attempt ${i} failed:`, e);
                if (i < MAX_ATTEMPTS) await new Promise(r => setTimeout(r, RETRY_MS));
            }
        }
        document.getElementById('conditions').textContent = 'Weather unavailable';
    }

    getWeather();
    setInterval(getWeather, 10 * 60 * 1000); // Every 10 minutes

    /* ── Prevent scroll / bounce ── */
    document.addEventListener('touchmove', e => e.preventDefault(), { passive: false });

    /* ── Wake lock ── */
    async function keepAwake() {
        try { if (navigator.wakeLock) await navigator.wakeLock.request('screen'); }
        catch (e) { /* ignore */ }
    }
    keepAwake();
    document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible') { keepAwake(); getWeather(); }
    });
</script>
```

</body>
</html>