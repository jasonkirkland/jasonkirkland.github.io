<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gyroscope Maze</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body>
  <button onclick="enableGyroscope()">Enable Gyroscope</button>
  <script>
    let ball;
    let maze;
    let mazeWidth = 300;
    let mazeHeight = 500;
	let beta = 0;
	let gamma = 0;


    function setup() {
  createCanvas(mazeWidth, mazeHeight);
  ball = new Ball(width / 2, height / 2, 15);
  maze = new Maze(); // Make sure this line is present in your code
}



    function draw() {
      background(220);
	  
	  text(`Beta: ${beta.toFixed(2)}\nGamma: ${gamma.toFixed(2)}`, width / 2, height / 2);

      maze.display();
      ball.update();
      ball.display();
      ball.checkCollisions(maze.walls);
    }

    function enableGyroscope() {
      if (window.DeviceOrientationEvent) {
        window.addEventListener('deviceorientation', handleOrientation);
      } else {
        alert('Your device does not support the Gyroscope API.');
      }
    }

    function handleOrientation(event) {
      if (event.beta === null || event.gamma === null) return;

		beta = event.beta;
		gamma = event.gamma;

      let x = map(event.gamma, -90, 90, -1, 1);
      let y = map(event.beta, -180, 180, -1, 1);
      ball.applyForce(x, y);
    }


    class Ball {
	  constructor(x, y, r) {
		this.pos = createVector(x, y);
		this.vel = createVector();
		this.acc = createVector();
		this.r = r;
	  }

	  applyForce(x, y) {
		this.acc.x = x;
		this.acc.y = y;
	  }

	  update() {
		this.vel.add(this.acc);
		this.pos.add(this.vel);
		this.vel.mult(0.95);
		this.acc.mult(0);
	  }

	  display() {
		fill(255, 0, 0);
		noStroke();
		ellipse(this.pos.x, this.pos.y, this.r * 2);
	  }

	  checkCollisions(walls) {
		walls.forEach(wall => {
		  let wallRect = {
			left: wall.x,
			right: wall.x + wall.w,
			top: wall.y,
			bottom: wall.y + wall.h
		  };

		  let ballRect = {
			left: this.pos.x - this.r,
			right: this.pos.x + this.r,
			top: this.pos.y - this.r,
			bottom: this.pos.y + this.r
		  };

		  if (ballRect.right > wallRect.left && ballRect.left < wallRect.right &&
			  ballRect.bottom > wallRect.top && ballRect.top < wallRect.bottom) {
			// Horizontal collision
			if (this.vel.x > 0 && ballRect.right >= wallRect.left && ballRect.left <= wallRect.left) {
			  this.vel.x *= -1;
			  this.pos.x = wallRect.left - this.r;
			} else if (this.vel.x < 0 && ballRect.left <= wallRect.right && ballRect.right >= wallRect.right) {
			  this.vel.x *= -1;
			  this.pos.x = wallRect.right + this.r;
			}

			// Vertical collision
			if (this.vel.y > 0 && ballRect.bottom >= wallRect.top && ballRect.top <= wallRect.top) {
			  this.vel.y *= -1;
			  this.pos.y = wallRect.top - this.r;
			} else if (this.vel.y < 0 && ballRect.top <= wallRect.bottom && ballRect.bottom >= wallRect.bottom) {
			  this.vel.y *= -1;
			  this.pos.y = wallRect.bottom + this.r;
			}
		  }
		});
	  }
	}

    class Maze {
	  constructor() {
		this.walls = [
		  { x: 50, y: 100, w: 200, h: 20 },
		  { x: 50, y: 200, w: 200, h: 20 },
		  { x: 50, y: 300, w: 200, h: 20 },
		  { x: 50, y: 400, w: 200, h: 20 }
		];
	  }

	  display() {
		fill(0);
		this.walls.forEach(wall => {
		  rect(wall.x, wall.y, wall.w, wall.h);
		});
	  }
	}
  </script>
</body>
</html>
