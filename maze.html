<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Device Orientation Ball Movement</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 0;
        overflow: hidden;
      }
      canvas {
        display: block;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.17.1/matter.min.js"></script>
  </head>
  <body>
    <button onclick="requestDeviceOrientation()">Enable Device Orientation</button>
    <div id="canvasContainer"></div>

    <script>
      const canvasContainer = document.getElementById("canvasContainer");

      // Set up Matter.js
      const Engine = Matter.Engine,
        Render = Matter.Render,
        World = Matter.World,
        Bodies = Matter.Bodies,
        Body = Matter.Body;

      const engine = Engine.create();
      const render = Render.create({
        element: canvasContainer,
        engine: engine,
        options: {
          width: window.innerWidth,
          height: window.innerHeight,
          wireframes: false,
          background: "transparent",
        },
      });

      // Create the ball
      const ballRadius = 15;
      const ball = Bodies.circle(window.innerWidth / 2, window.innerHeight / 2, ballRadius, {
        render: {
          fillStyle: "red",
        },
      });
      World.add(engine.world, [ball]);

      // Create the walls
      const walls = [
        Bodies.rectangle(window.innerWidth / 2, 110, window.innerWidth - 100, 20, { isStatic: true }),
        Bodies.rectangle(window.innerWidth / 2, 310, window.innerWidth - 100, 20, { isStatic: true }),
        Bodies.rectangle(window.innerWidth / 2, 510, window.innerWidth - 100, 20, { isStatic: true }),
      ];
      World.add(engine.world, walls);

      // Add bounds
      const bounds = [
        Bodies.rectangle(window.innerWidth / 2, -25, window.innerWidth, 50, { isStatic: true }), // top
        Bodies.rectangle(window.innerWidth / 2, window.innerHeight + 25, window.innerWidth, 50, { isStatic: true }), // bottom
        Bodies.rectangle(-25, window.innerHeight / 2, 50, window.innerHeight, { isStatic: true }), // left
        Bodies.rectangle(window.innerWidth + 25, window.innerHeight / 2, 50, window.innerHeight, { isStatic: true }), // right
      ];
      World.add(engine.world, bounds);

      // Start the engine and renderer
      Engine.run(engine);
      Render.run(render);

      function handleOrientation(event) {
        const xForce = map(event.gamma, -90, 90, -0.05, 0.05);
        const yForce = map(event.beta, -180, 180, -0.05, 0.05);
        Body.applyForce(ball, ball.position, { x: xForce, y: yForce });
      }

      function requestDeviceOrientation() {
        if (typeof DeviceOrientationEvent !== "undefined" && typeof DeviceOrientationEvent.requestPermission === "function") {
          DeviceOrientationEvent.requestPermission()

            .then((permissionState) => {
              if (permissionState === "granted") {
                window.addEventListener("deviceorientation", handleOrientation);
              }
            })
            .catch(console.error);
        } else {
          // handle regular non iOS 13+ devices
          console.log("not iOS");
          window.addEventListener("deviceorientation", handleOrientation);
        }
      }
      function map(value, start1, stop1, start2, stop2) {
        return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
      }
    </script>
  </body>
</html>
